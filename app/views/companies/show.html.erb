<!DOCTYPE html>
<html>
    <head>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <!-- Add icon library -->
        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    </head>

    <body>
        <div class='body_content'>
            <%- model_class = Company -%>
                <div class="company_area">
                    <div class="company_overview">
                        <div class="company_wall_image">
                            <%if @company.wall_picture.attached?%>
                                <img> <%= image_tag @company.wall_picture %>
                            <%end%>
                        </div>

                        <div class="company_title_image">
                            <%if @company.avatar.attached?%>
                                <img> <%= image_tag @company.avatar %>
                            <%end%>
                        </div>

                        <div class="company_title_summary">
                            <div class="company_title_name">
                                <t><%= @company.name %></t>
                            </div>

                            <div class="company_score_star_overview">
                                <%# Cal culate rating score %>
                                <%if(@company.company_reviews.count > 0)%>
                                    <%rate_work_env = @company.company_reviews.sum('work_env_score').to_f / @company.company_reviews.count%>
                                    <%rate_salary = @company.company_reviews.sum('salary_score').to_f / @company.company_reviews.count%>
                                    <%rate_ot = @company.company_reviews.sum('ot_score').to_f / @company.company_reviews.count%>
                                    <%rate_manager = @company.company_reviews.sum('manager_score').to_f / @company.company_reviews.count%>
                                    <%rate_career = @company.company_reviews.sum('career_score').to_f / @company.company_reviews.count%>
                                    <%total_rate = (rate_work_env + rate_salary + rate_ot + rate_manager + rate_career)/5%>
                                <%else%>
                                    <%total_rate = 0%>
                                <%end%>

                                <div class="company_rating">
                                    <strong><%=total_rate.to_i%>.0</strong>
                                    <%if total_rate > 0%>
                                        <%total_rate.to_i.times do%>
                                            <span class="fa fa-star checked"></span>
                                        <%end%>
                                        <%(5 - total_rate.to_i).to_i.times do%>
                                            <span class="fa fa-star checked_out"></span>
                                        <%end%>
                                    <%else%>
                                        <%5.times do%>
                                            <span class="fa fa-star checked_out"></span>
                                        <%end%>
                                    <%end%>
                                </div>
                            </div>

                            <div class="company_title_short_des">
                                <t><%= @company.company_reviews.count %> đánh giá & <%= @company.company_interviews.count %> nhận xét</t>
                            </div>
                        </div>
                        <div class="company_follow">
                            <%= link_to '<button type="button"><i class="fa fa-heart fa checked"></i> Theo dõi </button>'.html_safe, company_path(@company) %>
                        </div>
                    </div>

                    <!-- Tab links -->
                    <div class="company_tab">
                        <button class="company_tablinks active" onclick="openContent(event, 'Company')"><h3><i class="material-icons">business</i> Công ty</h3></button>
                        <button class="company_tablinks" onclick="openContent(event, 'CompanyJoins')"><h3><i class="material-icons">favorite_border</i>Chính sách</h3></button>
                        <button class="company_tablinks" onclick="openContent(event, 'CompanyReviews')"><h3><i class="material-icons">rate_review</i>Đánh giá(<%= @company.company_reviews.count%>)</h3></button>
                        <button class="company_tablinks" onclick="openContent(event, 'CompanyInterviews')"><h3><i class="material-icons">group</i>Phỏng vấn (<%= @company.company_interviews.count%>)</h3></button>
                        <button class="company_tablinks" onclick="openContent(event, 'CompanySalarys')"><h3><i class="material-icons">local_offer</i>Lương</h3></button>
                        <button class="company_tablinks" onclick="openContent(event, 'CompanyJobs')"><h3><i class="material-icons">contact_mail</i>Tuyển dụng(<%= @company.company_jobs.count%>)</h3></button>
                    </div>

                    <!-- Tab content -->
                    <div id="Company" class="company_tabcontent" style="display:block;">
                        <%= render :partial => 'companies/profile' %>
                    </div>

                    <div id="CompanyJoins" class="company_tabcontent">
                        <%= render :partial => 'companies/why_join' %>
                    </div>

                    <div id="CompanyReviews" class="company_tabcontent">
                        <%= render :partial => 'company_reviews/review_score' %>
                        <div class="company_tab_des">
                            <strong class="user_comment_heading"> Tất cả <%= @company.company_reviews.count%> đánh giá về <%= @company.name %> </strong>
                            <%= render @company.company_reviews %>
                        </div>
                    </div>

                    <div id="CompanyInterviews" class="company_tabcontent">
                        <%= render :partial => 'company_interviews/interview_score' %>
                        <div class="company_tab_des">
                            <strong class="user_comment_heading"> Tất cả <%= @company.company_interviews.count%> kinh nghiệm phỏng vấn tại <%= @company.name %></strong>
                            <%= render @company.company_interviews %>
                        </div>
                    </div>

                    <div id="CompanySalarys" class="company_tabcontent">
                        <h3>Comming soon ...</h3>
                    </div>

                    <div id="CompanyJobs" class="company_tabcontent">
                        <div class="company_tab_des">
                            <div class="company_tab_job">
                                <strong class="user_comment_heading"> Tìm thấy <%= @company.company_jobs.count%> việc làm tại <%= @company.name %> </strong>
                                <div class="new_job">
                                    <div class="new_job_title">
                                        <strong>Bạn là nhà tuyển dụng</strong>
                                    </div>
                                    <%= link_to '<button type="submit">Đăng tin tuyển dụng miễn phí</button>'.html_safe, new_company_company_job_path(@company) %>
                                </div>
                            </div>
                            <%= render @company.company_jobs %>
                        </div>
                    </div>

                    <script>
                        function openContent(evt, companyTag) {
                            var i, company_tabcontent, company_tablinks;
                            company_tabcontent = document.getElementsByClassName("company_tabcontent");
                            for (i = 0; i < company_tabcontent.length; i++) {
                                company_tabcontent[i].style.display = "none";
                            }

                            company_tablinks = document.getElementsByClassName("company_tablinks");
                            for (i = 0; i < company_tablinks.length; i++) {
                                company_tablinks[i].className = company_tablinks[i].className.replace(" active", "");
                            }

                            document.getElementById(companyTag).style.display = "block";
                            evt.currentTarget.className += " active";
                        }
                    </script>
                </div>
            </div>
        </div>
    </body>
</html>
