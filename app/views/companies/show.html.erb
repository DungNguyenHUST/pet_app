<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
    </head>

    <body>
        <div class='body_content_full'>
            <%- model_class = Company -%>
                <div class="company_area">
                    <div class="company_overview">
                        <div class="company_wall_image">
                            <%if @company.wall_picture.attached?%>
                                <%= image_tag @company.wall_picture %>
                            <%end%>
                        </div>

                        <div class="company_title_image">
                            <%if @company.avatar.attached?%>
                                <img> <%= image_tag @company.avatar %>
                            <%end%>
                        </div>

                        <div class="company_title_summary">
                            <div class="company_title_name">
                                <t><%= @company.name %></t>
                            </div>

                            <div class="company_score_star_overview">
                                <%# Cal culate rating score %>
                                <%if(@company.company_reviews.count > 0)%>
                                    <%rate_work_env = @company.company_reviews.sum('work_env_score').to_f / @company.company_reviews.count%>
                                    <%rate_salary = @company.company_reviews.sum('salary_score').to_f / @company.company_reviews.count%>
                                    <%rate_ot = @company.company_reviews.sum('ot_score').to_f / @company.company_reviews.count%>
                                    <%rate_manager = @company.company_reviews.sum('manager_score').to_f / @company.company_reviews.count%>
                                    <%rate_career = @company.company_reviews.sum('career_score').to_f / @company.company_reviews.count%>
                                    <%total_rate = (rate_work_env + rate_salary + rate_ot + rate_manager + rate_career)/5%>
                                <%else%>
                                    <%total_rate = 0%>
                                <%end%>

                                <div class="company_rating">
                                    <strong><%=total_rate.to_i%>.0</strong>
                                    <%if total_rate > 0%>
                                        <%total_rate.to_i.times do%>
                                            <i class="material-icons checked">star</i>
                                        <%end%>
                                        <%(5 - total_rate.to_i).to_i.times do%>
                                            <i class="material-icons checked_out">star_outline</i>
                                        <%end%>
                                    <%else%>
                                        <%5.times do%>
                                            <i class="material-icons checked_out">star_outline</i>
                                        <%end%>
                                    <%end%>
                                </div>
                            </div>

                            <div class="company_title_short_des">
                                <t><%= @company.company_reviews.count %> đánh giá & <%= @company.company_interviews.count %> nhận xét</t>
                            </div>
                        </div>
                        <div class="company_follow">
                            <%= link_to '<button type="button"><i class="fa fa-heart fa checked"></i> Theo dõi </button>'.html_safe, company_path(@company) %>
                        </div>
                    </div>

                    <div class="company_tab">
                        <div class="tab_container">
                            <button class="tablinks active" id="CompanyID" onclick="openTab(event, 'Company')"><i class="material-icons">business</i> <a>Giới thiệu</a></button>
                            <button class="tablinks" id="CompanyJoinsID" onclick="openTab(event, 'CompanyJoins')"><i class="material-icons">favorite_border</i><a>Chính sách</a></button>
                            <button class="tablinks" id="CompanyReviewsID" onclick="openTab(event, 'CompanyReviews')"><i class="material-icons">sentiment_satisfied_alt</i><a>Review công ty</a><span> <%= @company.company_reviews.count%><span></button>
                            <button class="tablinks" id="CompanyInterviewsID" onclick="openTab(event, 'CompanyInterviews')"><i class="material-icons">people_outline</i><a>Phỏng vấn</a><span><%= @company.company_interviews.count%><span></button>
                            <button class="tablinks" id="CompanyJobsID" onclick="openTab(event, 'CompanyJobs')"><i class="material-icons">work_outline</i><a>Tuyển dụng</a><span><%= @company.company_jobs.count%><span></button>
                            <button class="tablinks" id="CompanySalarysID" onclick="openTab(event, 'CompanySalarys')"><i class="material-icons">attach_money</i><a>Lương</a><span><%= @company.company_jobs.count%><span></button>
                            <button class="tablinks" id="CompanySalarysID" onclick="openTab(event, 'CompanySalarys')"><i class="material-icons">help_outline</i><a>Q&A</a><span><%= @company.company_jobs.count%><span></a></button>
                            <button class="tablinks" id="CompanySalarysID" onclick="openTab(event, 'CompanySalarys')"><i class="material-icons">filter</i><a>Photo</a><span><%= @company.company_jobs.count%><span></a></button>
                        </div>

                        <div id="Company" class="tabcontent">
                            <div class="company_profile_tab">
                                <%= render :partial => 'companies/profile' %>
                            </div>
                        </div>

                        <div id="CompanyJoins" class="tabcontent">
                            <div class="company_policy_tab">
                                <%= render :partial => 'companies/why_join' %>
                            </div>
                        </div>

                        <div id="CompanyReviews" class="tabcontent">
                            <div class="company_review_tab">
                                <div class="company_review_score">
                                    <%= render :partial => 'company_reviews/review_score' %>
                                </div>
                                <div class="company_review_tab_des">
                                    <strong class="user_comment_heading"> Tất cả <%= @company.company_reviews.count%> đánh giá về <%= @company.name %> </strong>
                                    <div class="company_review_tab_des_left">
                                        <%= render @company.company_reviews %>
                                    </div>
                                    <div class="company_review_tab_des_right">
                                        <div class="company_job_label">
                                            <a> Việc làm </a>
                                        </div>
                                        <div class="company_job_des">
                                            <%@company.company_jobs.each do |company_job|%>
                                                <div class="company_job_block">
                                                    <div class="company_avatar">
                                                        <%if @company.avatar.attached?%>
                                                            <img><%= link_to (image_tag(@company.avatar)), image_path(url_for(@company.avatar)), rel: "gallery" , :href => company_path(@company)%>
                                                        <%end%>
                                                    </div>
                                                    <div class="company_job_title">
                                                        <%= link_to (company_job.title), company_company_job_path(@company, company_job) %>
                                                    </div>
                                                </div>
                                            <%end%>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="CompanyInterviews" class="tabcontent">
                            <div class="company_interview_tab">
                                <div class="company_interview_score">
                                    <%= render :partial => 'company_interviews/interview_score' %>
                                </div>
                                <div class="company_tab_des">
                                    <strong class="user_comment_heading"> Tất cả <%= @company.company_interviews.count%> kinh nghiệm phỏng vấn tại <%= @company.name %></strong>
                                    <div class="company_interview_tab_des_left">
                                        <%= render @company.company_interviews %>
                                    </div>
                                    <div class="company_interview_tab_des_right">
                                        <div class="company_job_label">
                                            <a> Việc làm </a>
                                        </div>
                                        <div class="company_job_des">
                                            <%@company.company_jobs.each do |company_job|%>
                                                <div class="company_job_block">
                                                    <div class="company_avatar">
                                                        <%if @company.avatar.attached?%>
                                                            <img><%= link_to (image_tag(@company.avatar)), image_path(url_for(@company.avatar)), rel: "gallery" , :href => company_path(@company)%>
                                                        <%end%>
                                                    </div>
                                                    <div class="company_job_title">
                                                        <%= link_to (company_job.title), company_company_job_path(@company, company_job) %>
                                                    </div>
                                                </div>
                                            <%end%>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="CompanyJobs" class="tabcontent">
                            <div class="company_tab_des">
                                <div class="company_job_tab">
                                    <div class="company_tab_job">
                                        <div class="new_job">
                                            <div class="new_job_title">
                                                <strong>Bạn là nhà tuyển dụng</strong>
                                            </div>
                                            <%= link_to '<button type="submit"><i class="material-icons">add</i><span>Đăng tin tuyển dụng miễn phí<span></button>'.html_safe, new_company_company_job_path(@company) %>
                                        </div>
                                        <div class="user_comment_heading_job">
                                            <strong> Tìm thấy <%= @company.company_jobs.count%> việc làm tại <%= @company.name %> </strong>
                                        </div>
                                    </div>
                                    <div class="company_job_index">
                                        <%= render @company.company_jobs %>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="CompanySalarys" class="tabcontent">
                            <div class="company_salary_tab">
                                <h3>Comming soon ...</h3>
                            </div>
                        </div>

                        <div id="CompanySalarys" class="tabcontent">
                            <div class="company_salary_tab">
                                <h3>Comming soon ...</h3>
                            </div>
                        </div>

                        <div id="CompanySalarys" class="tabcontent">
                            <div class="company_salary_tab">
                                <h3>Comming soon ...</h3>
                            </div>
                        </div>
                    </div>
                        
                    <script>
                        function openTab(evt, TabName) {
                            var i, tabcontent, tablinks;
                            tabcontent = document.getElementsByClassName("tabcontent");
                            for (i = 0; i < tabcontent.length; i++) {
                                tabcontent[i].style.display = "none";
                            }
                            tablinks = document.getElementsByClassName("tablinks");
                            for (i = 0; i < tablinks.length; i++) {
                                tablinks[i].className = tablinks[i].className.replace(" active", "");
                            }
                            document.getElementById(TabName).style.display = "block";

                            evt.currentTarget.className += " active";

                            document.cookie = "TabName="+TabName+"ID; expires=Thu, 18 Dec 2090 12:00:00 UTC; path=/";
                        }

                        document.addEventListener("DOMContentLoaded", function(){
                            // Handler when the DOM is fully loaded
                            var selectedTab = getCookie("TabName");
                            if (selectedTab != ""){
                                document.getElementById(selectedTab).click();
                            }
                            else
                            {
                                document.getElementById("CompanyID").click();
                            }
                        });

                        function getCookie(cname) {
                            var name = cname + "=";
                            var decodedCookie = decodeURIComponent(document.cookie);
                            var ca = decodedCookie.split(';');
                            for(var i = 0; i <ca.length; i++) {
                                var c = ca[i];
                                while (c.charAt(0) == ' ') {
                                    c = c.substring(1);
                                }
                                if (c.indexOf(name) == 0) {
                                    return c.substring(name.length, c.length);
                                }
                            }
                            return "";
                        }
                    </script>
                </div>
            </div>
        </div>
    </body>
</html>
