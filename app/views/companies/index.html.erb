<% content_for :meta_robots, "all" %>
<%- model_class = Company -%>
<%case @tab%>
<%when "default", "CompanyAllID"%>
    <%if !@is_company_searched%>
        <% title = t(:company_index_meta_1) %>
    <%else%>
        <% title = t(:company_index_meta_2)%>
    <%end%>
<%when "CompanyNewestID"%>
    <%title = t(:company_index_meta_3)%>
<%when "CompanyMostRecentID"%>
    <%title = t(:company_index_meta_4)%>
<%when "CompanyBestID"%>
    <%title = t(:company_index_meta_5)%>
<%else%>
    <%title = ""%>
<%end%>
<% content_for :meta_title, title %>
<% content_for :meta_description, t(:company_index_meta_6) %>
<div class="companies_index">
    <div class="companies_search">
        <div class="container">
            <div class='row'>
                <div class ="col-sm-6">
                    <div class="company_bar">
                        <div class="company_bar_label">
                            <h3><%=t(:company_index_label)%>.</h3>
                            <a><%=t(:company_index_label_sub)%>.</a>
                        </div>
                        
                        <%=form_tag companies_path, :method => "get" do%>
                            <div class='row'>
                                <div class="col-sm-10 col_padding_customize_right">
                                    <div class="company_search_input">
                                        <i class="material-icons-outlined">search</i>
                                        <%= text_field_tag :search, params[:search], data: { behavior: "autocomplete" }, required: true, class: 'form-control', placeholder: t(:company_index_search_hint)%>
                                    </div>
                                </div>
                                
                                <div class="col-sm-2 col_padding_customize_left">
                                    <div class="company_search_button">
                                        <%= button_to "", form_class: "search_button", :name => nil do%>
                                            <i class="material-icons-outlined">search</i>
                                            <a><%=t(:search)%></a>
                                        <%end%> 
                                    </div>
                                </div>
                            </div>
                        <%end%>

                        <script>
                            document.addEventListener("turbolinks:load", function() {
                                $input = $("[data-behavior='autocomplete']")

                                var options = {
                                    getValue: "name",
                                    url: function(phrase) {
                                        return "/companies.json?search=" + phrase;
                                    },
                                    categories: [
                                        {
                                            listLocation: "suggest_companies"
                                        },
                                    ],
                                    list: {
                                    onChooseEvent: function() {
                                            var url = $input.getSelectedItemData().url
                                            $input.val("")
                                            Turbolinks.visit(url)
                                        }
                                    }
                                }

                                $input.easyAutocomplete(options)
                            });
                        </script>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="company_bar_background">
                        <%=image_tag("others/company_background.svg")%>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="companies_area">
        <div class="container">
            <%if (@is_company_searched)%>
                <%= render :partial => 'companies/search', :object => @company_searchs %>
            <%else%>
                <div class="companies_section_title">
                    <span><%=t(:company_list)%></span>
                </div>
                
                <div class="company_index_tab_link">
                    <ul class="nav">
                        <li class="nav-item">
                            <%if @tab == "default" || @tab == "CompanyAllID"%>
                                <%active = "active"%>
                            <%else%> 
                                <%active = ""%>
                            <%end%> 
                            <a class="nav-link <%=active%>" href="<%=companies_path(tab: 'CompanyAllID')%>"><%=t(:all)%></a>
                        </li>
                        <li class="nav-item">
                            <%if @tab == "CompanyMostRecentID"%>
                                <%active = "active"%>
                            <%else%> 
                                <%active = ""%>
                            <%end%>
                            <a class="nav-link <%=active%>" href="<%=companies_path(tab: 'CompanyMostRecentID')%>"><%=t(:interesting)%></a>
                        </li>
                        <li class="nav-item">
                            <%if @tab == "CompanyNewestID"%>
                                <%active = "active"%>
                            <%else%> 
                                <%active = ""%>
                            <%end%>
                            <a class="nav-link <%=active%>" href="<%=companies_path(tab: 'CompanyNewestID')%>"><%=t(:lastest_company)%> </a>
                        </li>
                        <li class="nav-item">
                            <%if @tab == "CompanyBestID"%>
                                <%active = "active"%>
                            <%else%> 
                                <%active = ""%>
                            <%end%>
                            <a class="nav-link <%=active%>" href="<%=companies_path(tab: 'CompanyBestID')%>"><%=t(:best_company)%></a>
                        </li>
                    </ul>
                </div>

                <div class="company_index_tab_content">
                    <%if @tab == "default" || @tab == "CompanyAllID"%>
                        <div class="company_all_tab">
                            <div class="row">
                                <% @companies_oder_name.each do |company| %>
                                    <div class="col-sm-4">
                                        <%=render company%>
                                    </div>
                                <%end%>
                            </div>
                            <%= paginate @companies_oder_name, window: 2%>
                        </div>
                    <%end%>
                    
                    <%if @tab == "CompanyNewestID"%>
                        <div class="company_newest_tab">
                            <div class="row">
                                <% @companies_oder_newest.each do |company| %>
                                    <div class="col-sm-4">
                                        <%=render company%>
                                    </div>
                                <%end%>
                            </div>
                            <%= paginate @companies_oder_newest, window: 2%>
                        </div>
                    <%end%>

                    <%if @tab == "CompanyMostRecentID"%>
                        <div class="company_most_recent_tab">
                            <div class="row">
                                <% @companies_most_recent.each do |company| %>
                                    <div class="col-sm-4">
                                        <%=render company%>
                                    </div>
                                <%end%>
                            </div>
                            <%= paginate @companies_most_recent, window: 2%>
                        </div>
                    <%end%>

                    <%if @tab == "CompanyBestID"%>
                        <div class="company_best_tab">
                            <div class="row">
                                <% @companies_best.each do |company| %>
                                    <div class="col-sm-4">
                                        <%=render company%>
                                    </div>
                                <%end%>
                            </div>
                            <%= paginate @companies_best, window: 2%>
                        </div>
                    <%end%>
                </div>
            <%end%>

            <%=form_tag pages_select_company_path, :method => "get" do%>
                <div class="company_current_review">
                    <div class='row'>
                        <div class="col-sm-4">
                            <div class="company_current_review_title">
                                <i class="material-icons-outlined checked">create</i><a> <%=t(:review_your_company)%> </a>
                            </div>
                        </div>
                            
                        <div class="col-sm-6">
                            <div class="user_select_company">
                                <%= select_tag :company_id, 
                                    options_from_collection_for_select(Company.all, "id", "name"), 
                                    required: true,
                                    include_blank: false,
                                    :prompt => t(:select_company),
                                    class: "form-select company_review_select"%>
                            </div>

                            <script>
								$(document).ready(function() {
									$('.company_review_select').select2({
										placeholder: "<%=t(:select_company)%>",
										allowClear: true,
										width: 'resolve',
										theme: "bootstrap-5",
										selectOnClose: true
									});
								});
							</script>
                        </div>
                        
                        <div class='col-sm-2'>
                            <div class="user_select_start">
                                <%= button_to "", form_class: "select_button", :name => nil do%>
                                    <a><%=t(:write_review)%></a>
                                <%end%> 
                            </div>
                        </div>
                    </div>
                </div>
            <%end%>
            
            <div class="breadcrumbs">
                <%= render_breadcrumbs :separator => '<i class="material-icons-outlined">keyboard_arrow_right</i>' %>
            </div>
        </div>
    </div>
</div>