<!DOCTYPE html>
<html>
    <head>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
    </head>

    <body>
        <div class='body_content_full'>
            <div class="home_page">
                <div class="home_search_bar">
                    <div class="home_search_bar_label">
                        <h3>Tìm kiếm công việc mơ ước</h3>
                        <span>Khám phá <%= @companies.count%> công ty và <%= @company_jobs.count%> việc làm cùng hơn <%= @company_reviews.count%>+ đánh giá từ mọi người</span>
                    </div>
                    <%=form_tag companies_path, :method => "get" do%>
                        <div class="home_search_form_text">
                            <%= text_field_tag :search, params[:search], class: 'home_search_input', placeholder: "Tìm kiếm theo công việc, kĩ năng hoặc tên công ty" %>
                            <i class="material-icons checked">search</i>
                        </div>
                        <div class="home_search_form_address">
                            <%= text_field_tag :search, params[:search], class: 'home_search_input', placeholder: "Hà Nội"%>
                            <i class="material-icons checked">place</i>
                        </div>
                        <div class="home_search_button">
                            <%= submit_tag "Tìm kiếm ", :name => nil, class: 'search_button'%>
                        </div>
                    <%end%>
                </div>
                <div class="home_top_company">
                    <div class="home_top_company_label">
                        <h3><i class="material-icons">business</i>Top công ty được yêu thích</h3>
                    </div>
                    <% @companies.each do |company| %>
                        <div class="single_company">
                            <div class="company_thumbnail">
                                <%if company.avatar.attached?%>
                                    <%= link_to (image_tag(company.avatar)), image_path(url_for(company.avatar)), rel: "gallery" , :href => company_path(company)%>
                                <%end%>
                            </div>

                            <div class="company_love_button">
                                <%= link_to '<button type="button"><i class="material-icons">favorite_border</i></button>'.html_safe, company_path(company) %>
                            </div>

                            <div class="company_name">
                                <t> <%= link_to company.name, company_path(company), class: "company_name_label" %></t>
                            </div>
                            
                            <div class="company_summary">
                                <%# Cal culate rating score %>
                                <%if(company.company_reviews.count > 0)%>
                                    <%rate_work_env = company.company_reviews.sum('work_env_score').to_f / company.company_reviews.count%>
                                    <%rate_salary = company.company_reviews.sum('salary_score').to_f / company.company_reviews.count%>
                                    <%rate_ot = company.company_reviews.sum('ot_score').to_f / company.company_reviews.count%>
                                    <%rate_manager = company.company_reviews.sum('manager_score').to_f / company.company_reviews.count%>
                                    <%rate_career = company.company_reviews.sum('career_score').to_f / company.company_reviews.count%>
                                    <%total_rate = (rate_work_env + rate_salary + rate_ot + rate_manager + rate_career)/5%>
                                <%else%>
                                    <%total_rate = 0%>
                                <%end%>

                                <div class="company_location">
                                    <p><i class="material-icons">place</i> <%= company.location %></p>
                                </div>

                                <div class="company_rating">
                                    <div class="review_score_star">
                                        <%if total_rate > 0%>
                                            <%total_rate.to_i.times do%>
                                                <i class="material-icons checked">star</i>
                                            <%end%>
                                            <%(5 - total_rate.to_i).to_i.times do%>
                                                <i class="material-icons checked_out">star_outline</i>
                                            <%end%>
                                        <%else%>
                                            <%5.times do%>
                                                <i class="material-icons checked_out">star_outline</i>
                                            <%end%>
                                        <%end%>
                                    </div>
                                </div>

                                <div class="review_point">

                                    <div class="review_point_review_content">
                                        <t><%= company.company_reviews.count%></t>
                                    </div>

                                    <div class="review_point_review_content">
                                        <t><%= company.company_interviews.count %></t>
                                    </div>

                                    <div class="review_point_review_content">
                                        <t><%= company.company_jobs.count %></t>
                                    </div>

                                    <div class="review_point_label">
                                        <t> <%= link_to " Đánh giá", company_path(company), class: "review_point_review_label" %></t>
                                    </div>

                                    <div class="review_point_label">
                                        <t> <%= link_to " Phỏng vấn", company_path(company), class: "review_point_review_label" %></t>
                                    </div>

                                    <div class="review_point_label">
                                        <t> <%= link_to " Việc làm", company_path(company), class: "review_point_review_label" %></t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <%end%>
                </div>
                <div class="home_top_job">
                    <div class="home_top_job_label">
                        <h3><i class="material-icons">work_outline</i>Việc làm mới dành cho bạn</h3>
                    </div>
                    <% @companies.each do |company| %>
                        <%company.company_jobs.each do |company_job|%>
                            <div class="user_job_block">
                                <div class="user_job_left">
                                    <div class="user_avatar">
                                        <%if company.avatar.attached?%>
                                            <%= link_to (image_tag(company.avatar)), image_path(url_for(company.avatar)), rel: "gallery" , :href => company_path(company)%>
                                        <%end%>
                                    </div>
                                </div>

                                <div class="user_job_middle">
                                    <div class="user_job_title">
                                        <strong><%= link_to (company_job.title), company_company_job_path(company, company_job) %></strong>
                                    </div>

                                    <div class="user_job_description">
                                        <t><%= company_job.description %></t>
                                    </div>

                                    <div class="user_job_location">
                                        <t><i class="material-icons">room</i><%= company_job.location %></t>
                                    </div>

                                    <div class="user_job_salary">
                                        <t><i class="material-icons">local_offer</i><%= company_job.salary %></t>
                                    </div>
                                </div>

                                <div class="user_job_right">
                                    <div class="apply_job_button">
                                        <%= link_to '<button type="submit">Ứng tuyển</button>'.html_safe, new_company_apply_job_path(company.id, company_job.id)%>
                                    </div>
                                    <div class="user_job_date">
                                        <t><%= time_ago_in_words(company_job.created_at) %></t>
                                    </div>
                                </div>
                            </div>
                        <%end%>
                    <%end%>
                </div>
            </div>
        </div>
    </body>
</html>
