<!-- reviews container -->
<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
    </head>

    <body>
        <div class="user_review_block">
            <div class="user_review_intro">
                <div class="user_review_intro_left">
                    <div class="user_avatar">
                        <%if @company.avatar.attached?%>
                            <%= link_to (image_tag(@company.avatar)), image_path(url_for(@company.avatar)), rel: "gallery" , :href => company_path(@company)%>
                        <%end%>
                    </div>

                    <div class="user_info">
                        <div class="user_name">
                            <a><%=company_review.user_name%></a>
                        </div>
                        <div class="user_time_review">
                            <a><%= time_ago_in_words(company_review.created_at) %></a>
                        </div>
                    </div>
                </div>

                <div class="user_review_intro_right">
                    <div class="user_review_title">
                        <a><%= company_review.review_title %></a>
                    </div>

                    <div class="user_review_score_star">
                        <div class="review_point">
                            <strong><%=company_review.average_score.to_i%>.0 </strong>
                        </div>
                        <div class="review_score_star">
                                <%company_review.average_score.to_i.times do%>
                                    <i class="material-icons checked">circle</i>
                                <%end%>
                                <%(5 - company_review.average_score.to_i).to_i.times do%>
                                    <i class="material-icons checked_out">radio_button_unchecked</i>
                                <%end%>
                        </div>
                    </div>

                    <div class="user_review_status">
                            <a><%= company_review.position %></a>
                            <%if company_review.working_status%>
                                <a> • Nhân viên đang làm việc</a>
                            <%else%>
                                <a> • Đã nghỉ việc</a>
                            <%end%>
                            <a> • <%= company_review.working_time%></a>
                    </div>

                    <div class="user_review_cotent">
                        <div class="user_review_pros">
                            <div class="user_review_pros_label">
                                <i class="material-icons-outlined checked">check_circle_outline</i>
                                <strong>Ưu điểm</strong>
                            </div>
                            <div class="user_review_pros_content">
                                <a><%= company_review.pros %></a>
                            </div>
                        </div>

                        <div class="user_review_cons">
                            <div class="user_review_cons_label">
                                <i class="material-icons-outlined checked">clear</i>
                                <strong>Nhược điểm</strong>
                            </div>
                            <div class="user_review_cons_content">
                                <a><%= company_review.cons %></a>
                            </div>
                        </div>

                        <div class="user_review_body">
                            <a><%= company_review.review_rich_text %></a>
                        </div>

                        <div class="review_info">
                            <div class="review_toolbar">
                                <div class="review_reply_button">
                                    <a><%= company_review.company_reply_reviews.count%></a>
                                    <%if logged_in?%>
                                        <button class="reply_btn" onclick="myFunctionReplyReview(<%=company_review.id%>)"><i class="material-icons-outlined">chat_bubble_outline</i> <span>Trả lời</span> </button>
                                    <%else%>
                                        <%= link_to '<button class="reply_btn"><i class="material-icons-outlined">chat_bubble_outline</i> <span>Trả lời</span> </button>'.html_safe, login_path%>
                                    <%end%>
                                </div>
                                <div class="review_like_button" id="like_review_<%=company_review.id%>">
                                    <div class="like_count">
                                        <a><%= company_review.company_like_reviews.count%></a>
                                    </div>
                                    <%if logged_in?%>
                                        <% pre_like = company_review.company_like_reviews.find { |like| like.user_id == current_user.id} %>
                                        <% if pre_like %>  
                                            <%= button_to company_company_review_company_like_review_path(@company, company_review, pre_like), method: :delete, remote: true, form_class: "like_btn_highlight" do %>
                                                <i class="material-icons">thumb_up</i> <span>Thích</span>
                                            <%end%>
                                        <%else%>
                                            <%= button_to company_company_review_company_like_reviews_path(@company, company_review, pre_like), method: :post, remote: true, form_class: "like_btn" do %>
                                                <i class="material-icons-outlined">thumb_up</i> <span>Thích</span>
                                            <%end%>
                                        <%end%>
                                    <%else%>
                                        <%= button_to login_path, :method => :get, form_class: "like_btn" do%>
                                            <i class="material-icons-outlined">thumb_up</i> <span>Thích</span>
                                        <%end%>
                                    <%end%>
                                </div>
                                <div class="review_dislike_button" id="dislike_review_<%=company_review.id%>">
                                    <div class="dislike_count">
                                        <a><%= company_review.company_dislike_reviews.count%></a>
                                    </div>
                                    <%if logged_in?%>
                                        <% pre_dislike = company_review.company_dislike_reviews.find { |dislike| dislike.user_id == current_user.id} %>
                                        <% if pre_dislike %>
                                            <%= button_to company_company_review_company_dislike_review_path(@company, company_review, pre_dislike), :method => :delete, remote: true, form_class: "dislike_btn_highlight" do%>
                                                <i class="material-icons">thumb_down</i> <span>Không thích</span>
                                            <%end%> 
                                        <%else%>
                                            <%= button_to company_company_review_company_dislike_reviews_path(@company, company_review), method: :post, remote: true, form_class: "dislike_btn" do%>
                                                <i class="material-icons-outlined">thumb_down</i> <span>Không thích</span>
                                            <%end%> 
                                        <%end%>
                                    <%else%>
                                        <%= button_to login_path, :method => :get, form_class: "dislike_btn" do%>
                                            <i class="material-icons-outlined">thumb_down</i> <span>Không thích</span>
                                        <%end%>
                                    <%end%>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="new_reply_review_form" id ="<%=company_review.id%>">
                <%= form_for [@company, company_review, CompanyReplyReview.new] do |f| %>
                    <div class="new_reply_review_content">
                        <div class="new_reply_review_input_review">
                            <%= f.text_area :reply_content, class: "new_reply_review_form_input_review", placeholder: "Nhập vào câu trả lời của bạn" %>
                        </div>
                    </div>

                    <div class="new_reply_review_submit">
                        <button type="submit" class="new_reply_review_form_submit">
                            <i class="material-icons-outlined">send</i>
                        </button>
                    </div>
                <%end%>
            </div>

            <script>
                function myFunctionReplyReview(review_id) {
                    var x = document.getElementById(review_id);
                    if (x.style.display == "none") 
                    {
                        x.style.display = "block";
                    } 
                    else 
                    {
                        x.style.display = "none";
                    }
                }
            </script>

            <div class="reply_review_content">
                <%if company_review.company_reply_reviews.count > 0%>
                    <div class="review_reply">
                        <%= render company_review.company_reply_reviews %>
                    </div>
                <%end%>
            </div>
        </div>
    </body>
</html>